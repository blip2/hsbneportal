{% extends 'base.html' %}

{% block page_title %}Available Slots{% endblock page_title %}

{% block content %}
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <h2>{{ signup.name }}</h2>
          <p>{{ signup.description|linebreaksbr }}</p>

          {% if signup.audition_notice %}<p class="alert alert-info">Please make sure you have read the <a href="{{ signup.audition_notice }}">audition notice</a> before selecting a slot from the list below to signup</p>{% endif %}

          {% if signup.member_only %}<p class="alert alert-warning">Please note that this is a member-only event. You must be a current Sedos member to sign-up.</p>{% endif %}

          <div class="panel panel-default">
            {% for date,slots in ordered.items %}
            <div class="panel-heading" role="tab" id="slotg_{{ date|date:"dmy" }}">
              <h4 class="panel-page_title" data-toggle="collapse" data-target="#slotgroup_{{ date|date:"dmy" }}">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#slotgroup_{{ date|date:"dmy" }}" aria-expanded="true" aria-controls="slotgroup_{{ date|date:"dmy" }}">
                  {{ date|date:"l jS F Y" }}
                </a>
              </h4>
            </div>
            <div id="slotgroup_{{ date|date:"dmy" }}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="slotg_{{ date|date:"dmy" }}">
              <div class="panel-body">
                <table class="table table-striped table-condensed">
                  <thead><th>Start</th><th>End</th><th></th><th></th></thead>
                  <tbody>
                    {% for slot in slots %}
                    <tr>
                      <td>{{ slot.start|date:"H:i" }}</td>
                      <td>{{ slot.end|date:"H:i" }}</td>
                      <td>{% if slot.free_places %}{% if slot.places == 1 %}Slot{% else %}{{ slot.free_places }} / {{ slot.places }} places{% endif %} available{% if slot.free_places <= slot.other_places.count %} (pending requests){% endif %}{% else %}All places taken{% endif %}</td>
                      <td>{% if slot.expired %}
                        <a class="btn btn-xs btn-default disabled" href="" role="button">Signup Closed</a>
                      {% elif not slot.free_places and slot.places %}
                        {% if not slot.signup.allow_queue %}
                          <a class="btn btn-xs btn-default disabled" href="" role="button">Unavailable</a>
                        {% else %}
                          <a class="btn btn-xs btn-info" href="{% url 'signups.interest' id=slot.id %}" role="button">Register Interest &raquo;</a>
                        {% endif %}
                      {% else %}
                        <a class="btn btn-xs {% if slot.free_places <= slot.other_places.count  %}btn-warning{% else %}btn-primary{% endif %}" href="{% url 'signups.slot-signup' id=slot.id %}" role="button">Signup &raquo;</a>
                      {% endif %}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
            {% empty %}
            <p class="alert alert-warning">There do not seem to be any slots for this signup.</p>
            {% endfor %}

          </div>
          <a href="{% url 'signups.list' %}" class="btn btn-default">&laquo; Back to signup list</a>
        </div>
      </div>
    </div>
{% endblock %}
